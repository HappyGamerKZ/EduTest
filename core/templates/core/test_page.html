{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ session.test.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
</head>
<script src="{% static 'admin/js/theme.js' %}"></script>
<body class="container mt-4">
    <div class="d-flex justify-content-end mb-3">
        <button class="btn btn-outline-secondary" onclick="cycleTheme()">üåó –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
    </div>

    <h2>{{ session.test.title }}</h2>

    {% if time_limit_seconds %}
        <div class="alert alert-warning">
            ‚è≥ –û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: <span id="timer"></span>
        </div>
    {% endif %}

    <form method="post" id="test-form">
        {% csrf_token %}
        {% for question in questions %}
            <div class="mb-4">
                <strong>{{ forloop.counter }}. {{ question.text }}</strong><br>
                {% if question.question_type == 'single' %}
                    {% for option in question.options.all %}
                        <label><input type="radio" name="q{{ question.id }}" value="{{ option.id }}"> {{ option.text }}</label><br>
                    {% endfor %}
                {% elif question.question_type == 'multiple' %}
                    {% for option in question.options.all %}
                        <label><input type="checkbox" name="q{{ question.id }}" value="{{ option.id }}"> {{ option.text }}</label><br>
                    {% endfor %}
                {% elif question.question_type == 'text' %}
                    <textarea class="form-control" name="q{{ question.id }}"></textarea>
                {% endif %}
            </div>
        {% endfor %}
        <button type="submit" class="btn btn-success">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>
    </form>

    {% if time_limit_seconds %}
    <script>
        let timeLeft = {{ time_limit_seconds }};
        const timerEl = document.getElementById('timer');
        const form = document.getElementById('test-form');

        function updateTimer() {
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                alert("‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ! –û—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.");
                form.submit();
            }

            timeLeft--;
        }

        updateTimer();  // –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤
        const timerInterval = setInterval(updateTimer, 1000);
    </script>
    {% endif %}
</body>
</html>
